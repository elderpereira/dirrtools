<!DOCTYPE html>
<html>
<head>
    <title>Ferramentas do Site</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://unpkg.com/json-viewer-js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://rawgit.com/abodelot/jquery.json-viewer/master/json-viewer/jquery.json-viewer.js"></script>
    <link href="https://rawgit.com/abodelot/jquery.json-viewer/master/json-viewer/jquery.json-viewer.css" type="text/css" rel="stylesheet">
</head>
<body>
    <h1><i class="fas fa-wrench"></i> Ferramentas do Dirr</h1>

    <!-- Controles -->
    <div id="controles">
        <label><input type="checkbox" id="contadorCaracteres" onchange="toggleFerramenta('contadorCaracteres')"> Contador de Caracteres</label>
        <label><input type="checkbox" id="conversorData" onchange="toggleFerramenta('conversorData')"> Conversor de Data</label>
        <label><input type="checkbox" id="construtorTabela" onchange="toggleFerramenta('construtorTabela')"> JSON para Tabela</label>
    </div>
    <div id="ferramentas">
    <!-- contador de caracteres -->
    <div id="contadorCaracteresFerramenta" class="ferramenta" style="display: none;">
        <h2>Contador de Caracteres</h2>
        <input type="text" id="texto" oninput="contarCaracteres()">
        <p id="contador">0 caracteres</p>
    </div>

    <!-- conversor de data -->
    <div id="conversorDataFerramenta" class="ferramenta" style="display: none;">
        <h2>Conversor de Data</h2>
        <input type="datetime-local" id="data">
        <button onclick="converterData()">Converter</button>
        <p id="resultado"></p>
    </div>

    <!-- Construtor de Tabela -->
    <div id="construtorTabelaFerramenta" class="ferramenta" style="display: none;">
        <h2>Construtor de Tabela</h2>
        <div id="entradaJson">
            <textarea id="jsonInput" placeholder="Insira o JSON aqui" onchange="atualizarJsonViewer()"></textarea>
            <button onclick="construirTabela()">Construir Tabela</button>
            <div id="jsonViewer"></div>
        </div>
        <div id="tabela"></div>
        <button id="voltar" onclick="voltar()" style="display: none;">Voltar</button>
    </div>
    


    <!-- as ferramentas ficam acima disso aq -->
    </div>

    <script>
        // Função para mostrar/ocultar ferramentas
        function toggleFerramenta(id) {
            var checkbox = document.getElementById(id);
            var ferramenta = document.getElementById(id + 'Ferramenta');
            var ferramentas = document.getElementById('ferramentas');

            if (checkbox.checked) {
                ferramenta.style.display = 'block';
                ferramentas.insertBefore(ferramenta, ferramentas.firstChild);
            } else {
                ferramenta.style.display = 'none';
            }
        }
        // Função para contar caracteres
        function contarCaracteres() {
            var entrada = document.getElementById('texto');
            var contador = document.getElementById('contador');
            contador.innerHTML = entrada.value.length + ' caracteres';
        }

        // Adicione mais funções de ferramentas aqui
        function converterData() {
            var data = document.getElementById('data').value;
            var momento = moment(data);

            if (!momento.isValid()) {
                alert('Por favor, insira uma data válida.');
                return;
            }

            var resultado = document.getElementById('resultado');
            resultado.innerHTML = 'Unix: ' + momento.unix() + ' <button onclick="copiarParaClipboard(\'' + momento.unix() + '\')">Copiar</button><br>' +
                                'ISO: ' + momento.toISOString() + ' <button onclick="copiarParaClipboard(\'' + momento.toISOString() + '\')">Copiar</button><br>' +
                                'Formato Local: ' + momento.format('LLLL') + ' <button onclick="copiarParaClipboard(\'' + momento.format('LLLL') + '\')">Copiar</button><br>' +
                                'Formato UTC: ' + momento.utc().format('LLLL') + ' <button onclick="copiarParaClipboard(\'' + momento.utc().format('LLLL') + '\')">Copiar</button>';
        }
        function copiarParaClipboard(texto) {
            var elemento = document.createElement('textarea');
            elemento.value = texto;
            document.body.appendChild(elemento);
            elemento.select();
            document.execCommand('copy');
            document.body.removeChild(elemento);
        }
        
        // Construtor de Tabela usando JSON
        function construirTabela() {
            var jsonInput = document.getElementById('jsonInput').value;
            var tabelaDiv = document.getElementById('tabela');
            var entradaJson = document.getElementById('entradaJson');
            var voltar = document.getElementById('voltar');

            try {
                var dados = JSON.parse(jsonInput);
                var tabela = criarTabela(dados);

                // Limpar a div da tabela e adicionar a nova tabela
                tabelaDiv.innerHTML = '';
                tabelaDiv.appendChild(tabela);

                // Ocultar a área de texto e mostrar a tabela e o botão de voltar
                entradaJson.style.display = 'none';
                tabelaDiv.style.display = 'block';
                voltar.style.display = 'block';
            } catch (e) {
                alert('JSON inválido!');
            }
        }

        function criarTabela(objeto) {
            var tabela = document.createElement('table');

            for (var chave in objeto) {
                var valor = objeto[chave];
                var linha = tabela.insertRow();

                var celulaChave = linha.insertCell();
                celulaChave.textContent = chave;

                var celulaValor = linha.insertCell();
                if (typeof valor === 'object' && valor !== null) {
                    celulaValor.appendChild(criarTabela(valor));
                } else {
                    celulaValor.textContent = valor;
                }
            }

            return tabela;
        }

        function voltar() {
            var entradaJson = document.getElementById('entradaJson');
            var tabelaDiv = document.getElementById('tabela');
            var voltar = document.getElementById('voltar');

            // Mostrar a área de texto e ocultar a tabela e o botão de voltar
            entradaJson.style.display = 'block';
            tabelaDiv.style.display = 'none';
            voltar.style.display = 'none';
        }

        function atualizarJsonViewer() {
            var jsonInput = document.getElementById('jsonInput').value;
            var dados;

            try {
                dados = JSON.parse(jsonInput);
            } catch (error) {
                alert('JSON inválido!');
                return;
            }

            $('#jsonViewer').jsonViewer(dados);
        }
    </script>
</body>
</html>